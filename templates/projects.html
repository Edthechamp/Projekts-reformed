<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projects</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='new-style.css') }}">
</head>
<link rel="stylesheet" href="{{ url_for('static', filename='css/new-style.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="app-layout">

<!-- Sidebar (shared) -->
<aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
        <span class="sidebar-title">Calendar App</span>
        <button id="sidebar-close-btn" class="sidebar-close-btn md:hidden">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <nav class="sidebar-nav">
        <h2 class="nav-heading">Menu</h2>
        <ul class="nav-list">
            <li><a href="{{ url_for('my_day') }}" class="nav-link"><i class="fas fa-calendar-day fa-fw mr-2"></i>My Day</a></li>
            <li><a href="{{ url_for('show_projects') }}" class="nav-link active"><i class="fas fa-tasks fa-fw mr-2"></i>Projects</a></li>
            <li><a href="{{ url_for('show_calendar') }}" class="nav-link"><i class="fas fa-calendar-alt fa-fw mr-2"></i>Calendar</a></li>
            <li><a href="#" class="nav-link"><i class="fas fa-cog fa-fw mr-2"></i>Settings</a></li>
        </ul>
    </nav>
    <div class="sidebar-footer">
        <p>&copy; 2025 Calendar</p>
    </div>
</aside>

  <div class="main">
    <h1>My Projects</h1>

    <form id="projectForm" class="add-project">
      <input type="text" id="projectName" placeholder="Enter project name" required />
      <input type="text" id="projectDescription" placeholder="Enter project description" required />
      <input type="date" id="projectDeadline" placeholder="Enter deadline" required />
      <button type="submit">Add Project</button>
    </form>

    <div id="projectList" class="project-list">
      <!-- Projects will be inserted here dynamically -->
    </div>
  </div>

  <script>
    const form = document.getElementById('projectForm');
    const input = document.getElementById('projectName');
    const deadLine = document.getElementById('projectDeadline');
    const description = document.getElementById('projectDescription');
    const list = document.getElementById('projectList');


    form.addEventListener('submit', e => {
      e.preventDefault();
      const name = input.value.trim();
      if (!name) return;

      DeadlineMilliseconds = new Date(deadLine.value).getTime();
      if (DeadlineMilliseconds < Date.now()) {
        alert('Please select a valid deadline.');
        return;
      }

      const project = { id: Date.now(), name };
      projectToFlask();
     });

    function projectToFlask() {
        const projectName = document.getElementById('projectName').value;
        const projectDescription = document.getElementById('projectDescription').value;
        const projectDeadline = document.getElementById('projectDeadline').value;

        console.log('Project added:', projectName, projectDescription, projectDeadline);

        fetch('/addProject', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({
            name: projectName,
            description: projectDescription,
            deadline: projectDeadline,

            })
        })
        
        .then(response => response.json())
        .then(data => {
            renderProjects();
        })
        .catch(error => console.error('Error:', error));
    }

    function removeProject(id,projectName) {
        fetch('/removeProject', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({ projectName })
        })
      .then(renderProjects())
    }

    function renderProjects() {
      list.innerHTML = '';
      fetch('/getProjects')
        .then(response => response.json())
        .then(data => {
          const projects = data.projects;
          if (projects.length === 0) {
            list.innerHTML = '<p>No projects available.</p>';
            return;
          } 
        })
        .catch(error => console.error('Error:', error));
        console.log('Projects fetched:', projects);
      projects.forEach(project => {
        const card = document.createElement('div');
        card.className = 'project-card';
        card.innerHTML = `
          <div class="info">
            <h3>${project.name}</h3>
          </div>
          <div class="actions">
            <button onclick="viewMilestones(${project.id})">Milestones</button>
            <button onclick="removeProject(${project.id}, '${project.name}')" class="danger">Remove</button>
          </div>
        `;
        list.appendChild(card);
      });
    }

    function viewMilestones(id) {
      alert('Milestones feature coming soon!');
    }


    function toggleMenu() {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
  
    const isOpen = sidebar.classList.contains("open");
    sidebar.classList.toggle("open");
    overlay.classList.toggle("show", !isOpen);
  }


  </script>
</body>
</html>
